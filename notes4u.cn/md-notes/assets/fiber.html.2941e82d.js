import{_ as n,o as a,c as s,e as t}from"./app.aabcb1ea.js";const e="/md-notes/assets/fiber.b18e0b17.png",p={},o=t(`<h3 id="_1-requestidlecallback" tabindex="-1"><a class="header-anchor" href="#_1-requestidlecallback" aria-hidden="true">#</a> 1. requestIdleCallback</h3><h4 id="_1-1-\u6838\u5FC3-api-\u529F\u80FD\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_1-1-\u6838\u5FC3-api-\u529F\u80FD\u4ECB\u7ECD" aria-hidden="true">#</a> 1.1 \u6838\u5FC3 API \u529F\u80FD\u4ECB\u7ECD</h4><p>\u5229\u7528\u6D4F\u89C8\u5668\u7684\u7A7A\u4F59\u65F6\u95F4\u6267\u884C\u4EFB\u52A1\uFF0C\u5982\u679C\u6709\u66F4\u9AD8\u4F18\u5148\u7EA7\u7684\u4EFB\u52A1\u8981\u6267\u884C\u65F6\uFF0C\u5F53\u524D\u6267\u884C\u7684\u4EFB\u52A1\u53EF\u4EE5\u88AB\u7EC8\u6B62\uFF0C\u4F18\u5148\u6267\u884C\u9AD8\u7EA7\u522B\u4EFB\u52A1\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">deadline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// deadline.timeRemaining() \u83B7\u53D6\u6D4F\u89C8\u5668\u7684\u7A7A\u4F59\u65F6\u95F4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-\u6D4F\u89C8\u5668\u7A7A\u4F59\u65F6\u95F4" tabindex="-1"><a class="header-anchor" href="#_1-2-\u6D4F\u89C8\u5668\u7A7A\u4F59\u65F6\u95F4" aria-hidden="true">#</a> 1.2 \u6D4F\u89C8\u5668\u7A7A\u4F59\u65F6\u95F4</h4><p>\u9875\u9762\u662F\u4E00\u5E27\u4E00\u5E27\u7ED8\u5236\u51FA\u6765\u7684\uFF0C\u5F53\u6BCF\u79D2\u7ED8\u5236\u7684\u5E27\u6570\u8FBE\u5230 60 \u65F6\uFF0C\u9875\u9762\u662F\u6D41\u7545\u7684\uFF0C\u5C0F\u4E8E\u8FD9\u4E2A\u503C\u65F6\uFF0C \u7528\u6237\u4F1A\u611F\u89C9\u5230\u5361\u987F</p><p>1s 60\u5E27\uFF0C\u6BCF\u4E00\u5E27\u5206\u5230\u7684\u65F6\u95F4\u662F 1000/60 \u2248 16 ms\uFF0C\u5982\u679C\u6BCF\u4E00\u5E27\u6267\u884C\u7684\u65F6\u95F4\u5C0F\u4E8E16ms\uFF0C\u5C31\u8BF4\u660E\u6D4F\u89C8\u5668\u6709\u7A7A\u4F59\u65F6\u95F4</p><p>\u5982\u679C\u4EFB\u52A1\u5728\u5269\u4F59\u7684\u65F6\u95F4\u5185\u6CA1\u6709\u5B8C\u6210\u5219\u4F1A\u505C\u6B62\u4EFB\u52A1\u6267\u884C\uFF0C\u7EE7\u7EED\u4F18\u5148\u6267\u884C\u4E3B\u4EFB\u52A1\uFF0C\u4E5F\u5C31\u662F\u8BF4 requestIdleCallback \u603B\u662F\u5229\u7528\u6D4F\u89C8\u5668\u7684\u7A7A\u4F59\u65F6\u95F4\u6267\u884C\u4EFB\u52A1</p><h4 id="_1-3-api-\u529F\u80FD\u4F53\u9A8C" tabindex="-1"><a class="header-anchor" href="#_1-3-api-\u529F\u80FD\u4F53\u9A8C" aria-hidden="true">#</a> 1.3 API \u529F\u80FD\u4F53\u9A8C</h4><p>\u9875\u9762\u4E2D\u6709\u4E24\u4E2A\u6309\u94AE\u548C\u4E00\u4E2ADIV\uFF0C\u70B9\u51FB\u7B2C\u4E00\u4E2A\u6309\u94AE\u6267\u884C\u4E00\u9879\u6602\u8D35\u7684\u8BA1\u7B97\uFF0C\u4F7F\u5176\u957F\u671F\u5360\u7528\u4E3B\u7EBF\u7A0B\uFF0C\u5F53\u8BA1\u7B97\u4EFB\u52A1\u6267\u884C\u7684\u65F6\u5019\u53BB\u70B9\u51FB\u7B2C\u4E8C\u4E2A\u6309\u94AE\u66F4\u6539\u9875\u9762\u4E2D DIV \u7684\u80CC\u666F\u989C\u8272\u3002</p><p>\u4F7F\u7528 requestIdleCallback \u5C31\u53EF\u4EE5\u5B8C\u7F8E\u89E3\u51B3\u8FD9\u4E2A\u5361\u987F\u95EE\u9898\u3002</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>playground<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>play<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>playground<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>work<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>start work<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>interaction<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>handle some user interaction<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">&lt;style&gt;
  .playground</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> palevioletred<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
&lt;/style&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> play <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;play&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> workBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;work&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> interactionBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;interaction&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> iterationCount <span class="token operator">=</span> <span class="token number">100000000</span>
<span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">var</span> <span class="token function-variable function">expensiveCalculation</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">IdleDeadline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>iterationCount <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> IdleDeadline<span class="token punctuation">.</span><span class="token function">timeRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span>
      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token operator">?</span> value <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> value <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    iterationCount <span class="token operator">=</span> iterationCount <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>expensiveCalculation<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

workBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>expensiveCalculation<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

interactionBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  play<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">&quot;palegreen&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-fiber" tabindex="-1"><a class="header-anchor" href="#_2-fiber" aria-hidden="true">#</a> 2 Fiber</h3><h4 id="_2-1-\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_2-1-\u95EE\u9898" aria-hidden="true">#</a> 2.1 \u95EE\u9898</h4><p>React 16 \u4E4B\u524D\u7684\u7248\u672C\u6BD4\u5BF9\u66F4\u65B0 VirtualDOM \u7684\u8FC7\u7A0B\u662F\u91C7\u7528\u5FAA\u73AF\u52A0\u9012\u5F52\u5B9E\u73B0\u7684\uFF0C\u8FD9\u79CD\u6BD4\u5BF9\u65B9\u5F0F\u6709\u4E00\u4E2A\u95EE\u9898\uFF0C\u5C31\u662F\u4E00\u65E6\u4EFB\u52A1\u5F00\u59CB\u8FDB\u884C\u5C31\u65E0\u6CD5\u4E2D\u65AD\uFF0C\u5982\u679C\u5E94\u7528\u4E2D\u7EC4\u4EF6\u6570\u91CF\u5E9E\u5927\uFF0C\u4E3B\u7EBF\u7A0B\u88AB\u957F\u671F\u5360\u7528\uFF0C\u76F4\u5230\u6574\u68F5 VirtualDOM \u6811\u6BD4\u5BF9\u66F4\u65B0\u5B8C\u6210\u4E4B\u540E\u4E3B\u7EBF\u7A0B\u624D\u80FD\u88AB\u91CA\u653E\uFF0C\u4E3B\u7EBF\u7A0B\u624D\u80FD\u6267\u884C\u5176\u4ED6\u4EFB\u52A1\u3002\u8FD9\u5C31\u4F1A\u5BFC\u81F4\u4E00\u4E9B\u7528\u6237\u4EA4\u4E92\uFF0C\u52A8\u753B\u7B49\u4EFB\u52A1\u65E0\u6CD5\u7ACB\u5373\u5F97\u5230\u6267\u884C\uFF0C\u9875\u9762\u5C31\u4F1A\u4EA7\u751F\u5361\u987F, \u975E\u5E38\u7684\u5F71\u54CD\u7528\u6237\u4F53\u9A8C\u3002</p><p>\u6838\u5FC3\u95EE\u9898\uFF1A\u9012\u5F52\u65E0\u6CD5\u4E2D\u65AD\uFF0C\u6267\u884C\u91CD\u4EFB\u52A1\u8017\u65F6\u957F\u3002 JavaScript \u53C8\u662F\u5355\u7EBF\u7A0B\uFF0C\u65E0\u6CD5\u540C\u65F6\u6267\u884C\u5176\u4ED6\u4EFB\u52A1\uFF0C\u5BFC\u81F4\u4EFB\u52A1\u5EF6\u8FDF\u9875\u9762\u5361\u987F\uFF0C\u7528\u6237\u4F53\u9A8C\u5DEE\u3002</p><h4 id="_2-2-\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_2-2-\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 2.2 \u89E3\u51B3\u65B9\u6848</h4><ol><li>\u5229\u7528\u6D4F\u89C8\u5668\u7A7A\u95F2\u65F6\u95F4\u6267\u884C\u4EFB\u52A1\uFF0C\u62D2\u7EDD\u957F\u65F6\u95F4\u5360\u7528\u4E3B\u7EBF\u7A0B</li><li>\u653E\u5F03\u9012\u5F52\u53EA\u91C7\u7528\u5FAA\u73AF\uFF0C\u56E0\u4E3A\u5FAA\u73AF\u53EF\u4EE5\u88AB\u4E2D\u65AD</li><li>\u4EFB\u52A1\u62C6\u5206\uFF0C\u5C06\u4EFB\u52A1\u62C6\u5206\u6210\u4E00\u4E2A\u4E2A\u7684\u5C0F\u4EFB\u52A1</li></ol><h4 id="_2-3-\u5B9E\u73B0\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#_2-3-\u5B9E\u73B0\u601D\u8DEF" aria-hidden="true">#</a> 2.3 \u5B9E\u73B0\u601D\u8DEF</h4><p>\u5728 Fiber \u65B9\u6848\u4E2D\uFF0C\u4E3A\u4E86\u5B9E\u73B0\u4EFB\u52A1\u7684\u7EC8\u6B62\u518D\u7EE7\u7EED\uFF0CDOM\u6BD4\u5BF9\u7B97\u6CD5\u88AB\u5206\u6210\u4E86\u4E24\u90E8\u5206\uFF1A</p><ol><li>\u6784\u5EFA Fiber (\u53EF\u4E2D\u65AD)</li><li>\u63D0\u4EA4 Commit (\u4E0D\u53EF\u4E2D\u65AD)</li></ol><p>DOM \u521D\u59CB\u6E32\u67D3: virtualDOM -&gt; Fiber -&gt; Fiber[] -&gt; DOM</p><p>DOM \u66F4\u65B0\u64CD\u4F5C: newFiber vs oldFiber -&gt; Fiber[] -&gt; DOM</p><h4 id="_2-4-fiber-\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_2-4-fiber-\u5BF9\u8C61" aria-hidden="true">#</a> 2.4 Fiber \u5BF9\u8C61</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{
  type         \u8282\u70B9\u7C7B\u578B (\u5143\u7D20, \u6587\u672C, \u7EC4\u4EF6)(\u5177\u4F53\u7684\u7C7B\u578B)
  props        \u8282\u70B9\u5C5E\u6027
  stateNode    \u8282\u70B9 DOM \u5BF9\u8C61 | \u7EC4\u4EF6\u5B9E\u4F8B\u5BF9\u8C61
  tag          \u8282\u70B9\u6807\u8BB0 (\u5BF9\u5177\u4F53\u7C7B\u578B\u7684\u5206\u7C7B hostRoot || hostComponent || classComponent || functionComponent)
  effects      \u6570\u7EC4, \u5B58\u50A8\u9700\u8981\u66F4\u6539\u7684 fiber \u5BF9\u8C61
  effectTag    \u5F53\u524D Fiber \u8981\u88AB\u6267\u884C\u7684\u64CD\u4F5C (\u65B0\u589E, \u5220\u9664, \u4FEE\u6539)
  parent       \u5F53\u524D Fiber \u7684\u7236\u7EA7 Fiber
  child        \u5F53\u524D Fiber \u7684\u5B50\u7EA7 Fiber
  sibling      \u5F53\u524D Fiber \u7684\u4E0B\u4E00\u4E2A\u5144\u5F1F Fiber
  alternate    Fiber \u5907\u4EFD fiber \u6BD4\u5BF9\u65F6\u4F7F\u7528
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="`+e+'">',28),i=[o];function c(l,u){return a(),s("div",null,i)}const d=n(p,[["render",c],["__file","fiber.html.vue"]]);export{d as default};
